#!/bin/bash
#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=# 
# wget https://mls.sk87.top/deb--config-network && bash deb--config-network
# version by 2025-11-14
# Sergey Krichko
#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=#=# 
set -euo pipefail
. /etc/os-release
#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#-#

# 0. [CONFIG-NETWORK]
echo "==>>==>>==>> [CONFIG-NETWORK] ->->-> START Configuration..."

CONFIG_FILE="/etc/network/interfaces"

# Get the name of the active interface
IFACE=$(ip -o -4 route show to default | awk '{print $5}')

# 1. [CONFIG-NETWORK] configuration
echo "==>>==>>==>> [CONFIG-NETWORK] ->->-> Interface found: $IFACE"
echo "Select network setup type:"
echo "d) Dynamic (DHCP)"
echo "s) Static IP"
read -p "Enter d or s: " MODE

# Create backup
cp "$CONFIG_FILE" "$CONFIG_FILE.bak"

if [[ "$MODE" == "d" ]]; then
  echo "==>>==>>==>> [CONFIG-NETWORK] ->->-> DHCP Configuration..."

  cat > "$CONFIG_FILE" <<EOF
auto lo
iface lo inet loopback

auto $IFACE
iface $IFACE inet dhcp
EOF

elif [[ "$MODE" == "s" ]]; then
  read -p "Enter a static IP address (e.g. 192.168.1.100): " IP_ADDR
  read -p "Enter a subnet mask (e.g. 255.255.255.0): " NETMASK
  read -p "Enter a gateway (e.g. 192.168.1.1): " GATEWAY
  read -p "Enter a DNS server(s) (e.g. 8.8.8 1.1.1.1): " DNS

  echo "==>>==>>==>> [CONFIG-NETWORK] ->->-> Setting up a static IP..."

  cat > "$CONFIG_FILE" <<EOF
auto lo
iface lo inet loopback

auto $IFACE
iface $IFACE inet static
  address $IP_ADDR
  netmask $NETMASK
  gateway $GATEWAY
  dns-nameservers $DNS
EOF

else
  echo "==>>==>>==>> [CONFIG-NETWORK][!] ->->-> Without changing network settings. Interruption."
  exit 1
fi

# Reboot network
echo "==>>==>>==>> [CONFIG-NETWORK] ->->-> Restarting the interface $IFACE..."
ifdown "$IFACE" && ifup "$IFACE"

# [NETWORK] >>> Network configuration ."
echo "==>>==>>==>> [CONFIG-NETWORK][âœ“] ->->-> Network configuration completed!"